#!/usr/bin/expect -f

# Disable timeout
set timeout -1

# Spawn the command with the token from environment
spawn flyctl -t $env(FLY_API_TOKEN) redis proxy -o gobazzinga-inc-584

# Expect the database selection prompt and send Enter (selects first/default)
expect "*Select a database to connect to*" {
    send "\r"
}

# Expect the confirmation message
expect "Proxying local port"

# Wait indefinitely to keep the proxy alive
expect {
    timeout { exp_continue }
    eof     { exit 1 }
}
